<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Chatbot JARVIS - Tipcar</title>

    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Trebuchet MS', Arial, sans-serif;
            background: linear-gradient(135deg, #11bae4 0%, #d0c3e2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            width: 100%; max-width: 800px;
            background: white; border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex; flex-direction: column;
            height: 90vh;
        }
        header {
            background: #4b6cb7;
            color: white;
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        h1 {
            font-size: 28px;
            display: flex; justify-content: center;
            gap: 10px;
        }
        .status {
            font-size: 14px; opacity: 0.9; margin-top: 5px;
        }
        .quick-btn {
            background: #243b7a; color: white;
            border: none; padding: 8px 14px;
            border-radius: 18px; cursor: pointer;
            font-size: 14px; transition: 0.2s;
        }
        .quick-btn:hover { background: #1a2d5c; }

        .chatbox {
            flex: 1; overflow-y: auto;
            padding: 20px; background: #fafafa;
            display: flex; flex-direction: column; gap: 15px;
        }
        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from {opacity:0; transform:translateY(10px);}
            to {opacity:1; transform:translateY(0);}
        }
        .user-message {
            align-self: flex-end; background: #4b6cb7; color: white;
            border-bottom-right-radius: 5px;
        }
        .bot-message {
            align-self: flex-start; background: #e8ebf0; color: #333;
            border-bottom-left-radius: 5px;
        }
        .system-message {
            align-self: center; background: #ffd166;
            padding: 10px;
            border-radius: 10px;
            color: #333; text-align: center;
        }
        .input-area {
            display: flex; padding: 15px;
            background: white; border-top: 1px solid #eee;
            gap: 10px;
        }
        #userInput {
            flex: 1; padding: 12px 16px; border-radius: 24px;
            border: 1px solid #ddd; font-size: 16px;
        }
        .typing-indicator {
            display: none;
            align-self: flex-start; background: #e8ebf0;
            padding: 12px 18px; border-radius: 18px;
        }
    </style>
</head>

<body>
<div class="container">
    <header>
        <h1>JARVIS Chatbot - Tipcar</h1>
        <div class="status">Conectado</div>

        <div id="quickButtons" style="margin-top: 15px; display:flex; flex-wrap:wrap; gap:10px; justify-content:center;">
            <button class="quick-btn" onclick="handleQuickButton('perfil')">Como criar um perfil de motorista no Tipcar?</button>
            <button class="quick-btn" onclick="handleQuickButton('participar')">Quem pode participar do Tipcar?</button>
            <button class="quick-btn" onclick="handleQuickButton('beneficios')">Quais sÃ£o os benefÃ­cios que posso adquirir no Tipcar?</button>
            <button class="quick-btn" onclick="handleQuickButton('dificuldade')">Estou com dificuldades de navegaÃ§Ã£o</button>
        </div>
    </header>

    <div class="chatbox" id="chatbox">
        <div class="message system-message">
            OlÃ¡, sou o JARVIS. Como posso ajudar vocÃª hoje?
        </div>
    </div>

    <div class="typing-indicator" id="typingIndicator">
        JARVIS estÃ¡ digitando...
    </div>

    <div id="subButtons" style="display:none; margin:10px 0; text-align:center;">
        <button class="quick-btn" onclick="handleSubButton('interface')">Dificuldade na interface</button>
        <button class="quick-btn" onclick="handleSubButton('carona')">Imprevisto com a carona</button>
    </div>

    <div class="input-area">
        <input type="text" id="userInput" placeholder="Digite sua mensagem..." autocomplete="off"/>
        <button onclick="sendMessage()">Enviar</button>
    </div>
</div>

<script>

    // =====================================================
    // ðŸ”µ BASE DE RESPOSTAS LOCAIS
    // =====================================================

    const quickResponses = {
        perfil: "Para criar um perfil de motorista, basta fazer login como motorista, informar sua idade e cadastrar sua CNH vÃ¡lida.",
        participar: "Todos podem participar do Tipcar, seja como motorista ou passageiro.",
        beneficios: "Ao usar o Tipcar, vocÃª recebe benefÃ­cios como vales de lojas parceiras e brindes exibidos no seu perfil.",
        dificuldade: "Claro, vou te ajudar! Escolha uma das opÃ§Ãµes abaixo:"
    };

    const subResponses = {
        interface: "Na interface do Tipcar, vocÃª encontra botÃµes como: InÃ­cio, Minhas Caronas, Perfil, Ajuda e ConfiguraÃ§Ãµes.",
        carona: "Se estiver com problemas na carona, recomendamos enviar mensagem diretamente ao motorista."
    };

    // =====================================================
    // ðŸ”µ MANIPULAÃ‡ÃƒO DE BOTÃ•ES RÃPIDOS
    // =====================================================

    function handleQuickButton(type) {
        const btn = document.querySelector(`[onclick="handleQuickButton('${type}')"]`);
        addMessage(btn.innerText, "user");

        if (type === "dificuldade") {
            addMessage(quickResponses.dificuldade, "bot");
            document.getElementById("subButtons").style.display = "block";
            return;
        }

        addMessage(quickResponses[type], "bot");
    }

    function handleSubButton(type) {
        const btn = document.querySelector(`[onclick="handleSubButton('${type}')"]`);
        addMessage(btn.innerText, "user");

        document.getElementById("subButtons").style.display = "none";
        addMessage(subResponses[type], "bot");
    }

    // =====================================================
    // ðŸ”µ FUNÃ‡ÃƒO REAL DE STREAMING PARA O BACKEND
    // =====================================================

    async function sendToBackend(message, onToken) {
        try {
            const response = await fetch("https://chat-jarvis-online.onrender.com/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message })
            });

            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let buffer = "";

            while (true) {
                const { value, done } = await reader.read();
                if (done) break;

                buffer += decoder.decode(value);
                const parts = buffer.split("\n\n");
                buffer = parts.pop();

                for (const part of parts) {
                    if (!part.startsWith("data: ")) continue;

                    const token = part.replace("data: ", "").trim();

                    if (token === "[END]") return;

                    onToken(token);
                }
            }

        } catch (err) {
            console.error("Erro ao se comunicar com o backend:", err);
            onToken("Desculpe, ocorreu um erro na resposta do servidor.");
        }
    }

    // =====================================================
    // ðŸ”µ ENVIO DE MENSAGEM
    // =====================================================

    async function sendMessage() {
        const input = document.getElementById("userInput");
        const text = input.value.trim();
        if (!text) return;

        addMessage(text, "user");
        input.value = "";

        const typingIndicator = document.getElementById("typingIndicator");
        typingIndicator.style.display = "block";

        const chatBox = document.getElementById("chatbox");

        const botMsg = document.createElement("div");
        botMsg.classList.add("message", "bot-message");
        chatBox.appendChild(botMsg);
        chatBox.scrollTop = chatBox.scrollHeight;

        await sendToBackend(text, (token) => {
            botMsg.innerText += token;
            chatBox.scrollTop = chatBox.scrollHeight;
        });

        typingIndicator.style.display = "none";
    }

    // =====================================================
    // ðŸ”µ ADICIONAR MENSAGEM
    // =====================================================

    function addMessage(text, type) {
        const box = document.getElementById("chatbox");
        const msg = document.createElement("div");
        msg.classList.add("message", type === "user" ? "user-message" : "bot-message");
        msg.innerText = text;
        box.appendChild(msg);
        box.scrollTop = box.scrollHeight;
    }

    // =====================================================
    // ðŸ”µ ENTER PARA ENVIAR
    // =====================================================

    document.getElementById("userInput").addEventListener("keydown", function(e) {
        if (e.key === "Enter") sendMessage();
    });

</script>




</body>
</html>



